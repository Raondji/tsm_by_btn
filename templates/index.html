<!-- <!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TSM by BTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body class="bg-gradient">
  <div class="container text-center mt-5">
    <div class="card shadow-lg p-5 mx-auto" style="max-width:600px;">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/4b/Bank_TABUNGAN_NEGARA.png" width="100">
      <h2 class="mt-3 text-primary fw-bold">TSM by BTN</h2>
      <p>Aplikasi berbasis AI untuk seleksi kandidat Bank BTN</p>
      <a href="/form" class="btn btn-primary">Mulai Seleksi</a>
    </div>
  </div>
</body>
</html> -->

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Talent Scoring Model - TSM</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f5f6fa;
      font-family: 'Poppins', sans-serif;
    }
    .card {
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
    }
    .lolos {
      background-color: #d4edda;
      color: #155724;
    }
    .tidak {
      background-color: #f8d7da;
      color: #721c24;
    }
    table th, table td {
      vertical-align: middle !important;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="card p-4">
      <h2 class="text-center mb-4">Talent Scoring Model (TSM)</h2>

      <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#formInput" type="button" role="tab">Form Manual</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="csv-tab" data-bs-toggle="tab" data-bs-target="#csvInput" type="button" role="tab">Upload CSV</button>
        </li>
      </ul>

      <div class="tab-content">
        <!-- FORM INPUT -->
        <div class="tab-pane fade show active" id="formInput" role="tabpanel">
          <form id="scoreForm">
            <div class="row g-3">
              <div class="col-md-4">
                <label>Nama</label>
                <input type="text" class="form-control" id="nama" required>
              </div>
              <div class="col-md-4">
                <label>Universitas</label>
                <input type="text" class="form-control" id="universitas" required>
              </div>
              <div class="col-md-4">
                <label>Jurusan</label>
                <input type="text" class="form-control" id="jurusan" required>
              </div>
              <div class="col-md-4">
                <label>IPK</label>
                <input type="number" step="0.01" class="form-control" id="ipk" required>
              </div>
              <div class="col-md-4">
                <label>TOEFL</label>
                <input type="number" class="form-control" id="toefl" required>
              </div>
              <div class="col-md-4">
                <label>Umur</label>
                <input type="number" class="form-control" id="umur" required>
              </div>
            </div>
            <div class="text-center mt-4">
              <button type="submit" class="btn btn-primary px-4">Hitung Skor</button>
            </div>
          </form>

          <div id="result" class="text-center mt-4"></div>
        </div>

        <!-- CSV INPUT -->
        <div class="tab-pane fade" id="csvInput" role="tabpanel">
          <div class="text-center mb-3">
            <input type="file" id="csvFile" accept=".csv" class="form-control w-50 mx-auto">
          </div>
          <div id="csvResult" class="table-responsive"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Fungsi menghitung skor (sama untuk form & CSV) =====
    function calculateScore(data) {
      let { universitas, jurusan, ipk, toefl, umur } = data;
      let base = 50;

      // Penyesuaian IPK & TOEFL
      let score = base + (ipk - 2.5) * 10 + (toefl - 400) / 10 - Math.abs(umur - 25) * 0.8;

      // Bonus universitas top
      const topUniv = ["UGM", "UI", "ITB", "UNDIP", "UNAIR"];
      if (topUniv.some(u => universitas.toUpperCase().includes(u))) score += 10;

      // Bonus jurusan relevan
      const relevantMajors = ["MANAJEMEN", "EKONOMI", "AKUNTANSI", "INFORMATIKA", "TEKNIK INDUSTRI"];
      if (relevantMajors.some(m => jurusan.toUpperCase().includes(m))) score += 5;

      // Batasi 0â€“100
      score = Math.max(0, Math.min(100, score));
      const status = score >= 65 ? "Lolos" : "Tidak Lolos";

      return { score: score.toFixed(2), status };
    }

    // ===== Mode Form Manual =====
    document.getElementById("scoreForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        universitas: document.getElementById("universitas").value,
        jurusan: document.getElementById("jurusan").value,
        ipk: parseFloat(document.getElementById("ipk").value),
        toefl: parseFloat(document.getElementById("toefl").value),
        umur: parseInt(document.getElementById("umur").value)
      };
      const nama = document.getElementById("nama").value;
      const result = calculateScore(data);

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `
        <div class="result-box ${result.status === 'Lolos' ? 'lolos' : 'tidak'}">
          <h4>${nama}</h4>
          <p>Skor: <strong>${result.score}</strong></p>
          <p>Status: <strong>${result.status}</strong></p>
        </div>
      `;
    });

    // ===== Mode Upload CSV =====
    document.getElementById("csvFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const rows = event.target.result.split(/\r?\n/).filter(r => r.trim() !== "");
        const headers = rows[0].split(",").map(h => h.trim().toLowerCase());
        const tableRows = [];

        for (let i = 1; i < rows.length; i++) {
          const cols = rows[i].split(",");
          if (cols.length < 6) continue;

          const [nama, universitas, jurusan, ipk, toefl, umur] = cols.map(c => c.trim());
          const result = calculateScore({
            universitas, jurusan,
            ipk: parseFloat(ipk),
            toefl: parseFloat(toefl),
            umur: parseInt(umur)
          });
          tableRows.push(`
            <tr>
              <td>${nama}</td>
              <td>${universitas}</td>
              <td>${jurusan}</td>
              <td>${ipk}</td>
              <td>${toefl}</td>
              <td>${umur}</td>
              <td>${result.score}</td>
              <td><span class="badge ${result.status === 'Lolos' ? 'bg-success' : 'bg-danger'}">${result.status}</span></td>
            </tr>
          `);
        }

        document.getElementById("csvResult").innerHTML = `
          <table class="table table-striped table-bordered align-middle">
            <thead class="table-primary text-center">
              <tr>
                <th>Nama</th>
                <th>Universitas</th>
                <th>Jurusan</th>
                <th>IPK</th>
                <th>TOEFL</th>
                <th>Umur</th>
                <th>Skor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>${tableRows.join("")}</tbody>
          </table>
        `;
      };
      reader.readAsText(file);
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
